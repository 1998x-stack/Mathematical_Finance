structure = {
    "1_Preliminaries_on_Financial_Markets": {
        "1.1_A_Primer_on_Banks_and_Rates": [
            "1.1.1_Banks_and_the_Federal_Funds_Rate",
            "1.1.2_Short-Term_and_Long-Term_Rates_and_Yield_Curves"
        ],
        "1.2_A_Primer_on_Securities_Markets": [
            "1.2.1_Securities_Markets_Organization",
            "1.2.2_Professional_Participants_in_Securities_Markets",
            "1.2.3_Bid-Ask_Spreads_and_Market_Liquidity",
            "1.2.4_Trading_Costs"
        ],
        "1.3_Economic_Indicators_That_May_Affect_Financial_Markets": []
    },
    "2_The_Time_Value_of_Money": {
        "2.1_Time": [],
        "2.2_Interest_Rate_and_Return_Rate": [
            "2.2.1_Interest_Rate",
            "2.2.2_Required_Return_Rate_and_the_Risk-Free_Rate",
            "2.2.3_Total_Return_Rate"
        ],
        "2.3_Simple_Interest": [],
        "2.4_Compound_Interest": [
            "2.4.1_Compounding_Nonnegative_Integer_Number_of_Periods",
            "2.4.2_Compounding_Nonnegative_Real_Number_of_Periods",
            "2.4.3_Fractional_Compounding_Versus_Simple_Interest",
            "2.4.4_Continuous_Compounding"
        ],
        "2.5_Generalized_Compound_Interest": [
            "2.5.1_Varying_Interest_and_Varying_Compounding_Periods",
            "2.5.2_APR_Versus_APY",
            "2.5.3_Geometric_Mean_Return_Versus_Arithmetic_Mean_Return"
        ],
        "2.6_The_Net_Present_Value_and_Internal_Rate_of_Return": [
            "2.6.1_Present_Value_and_NPV_of_a_Sequence_of_Net_Cash_Flows",
            "2.6.2_The_Internal_Return_Rate",
            "2.6.3_NPV_and_IRR_for_General_Net_Cash_Flows"
        ],
        "2.7_Annuity_Theory": [
            "2.7.1_Future_and_Present_Values_of_Simple_Ordinary_Annuities",
            "2.7.2_Amortization_Theory",
            "2.7.3_Annuities_with_Varying_Payments_and_Interest_Rates"
        ],
        "2.8_Applications_of_Annuities": [
            "2.8.1_Saving_Borrowing_and_Spending",
            "2.8.2_Equity_in_a_House",
            "2.8.3_Sinking_Funds"
        ],
        "2.9_Applications_to_Stock_Valuation": [
            "2.9.1_The_Dividend_Discount_Model",
            "2.9.2_Present_Value_of_Preferred_and_Common_Stocks"
        ],
        "2.10_Applications_to_Bond_Valuation": [
            "2.10.1_Bond_Terminologies",
            "2.10.2_Bond_Prices_Versus_Interest_Rates_and_Yield_to_Maturity"
        ],
        "2.11_Exercises": [
            "2.11.1_Conceptual_Exercises",
            "2.11.2_Application_Exercises",
            "2.11.3_Theoretical_Exercises"
        ],
        "References": []
    },
    "3_Portfolio_Theory_and_Security_Valuation": {
        "3.1_Single-Security_Portfolio_Theory": [
            "3.1.1_Security_Returns_and_Covariances",
            "3.1.2_Mean-Variance_Portfolio_Theory",
            "3.1.3_Efficient_Frontier_for_a_Single_Security",
            "3.1.4_The_Efficient_Frontier_with_a_Risk-Free_Asset",
            "3.1.5_Capital_Market_Line_and_Portfolio_Optimization",
            "3.1.6_Market_Equilibrium_and_the_Capital_Market_Line",
            "3.1.7_Risks_and_Covariances_of_the_Portfolio's_Securities",
            "3.1.8_Expectation_and_Volatility_of_Portfolio_Log_Return"
        ],
        "3.2_Two-Security_Portfolio_Theory": [
            "3.2.1_Preliminaries",
            "3.2.2_Efficient_Frontier_of_a_Two-Security_Portfolio",
            "3.2.3_Reducing_Risk_Through_Diversification"
        ],
        "3.3_Efficient_Frontier_for_N_Securities_with_Short_Selling": [
            "3.3.1_N-Security_Portfolio_Quantities_in_Matrix_Notation",
            "3.3.2_Derivation_of_the_N-Security_Efficient_Frontier"
        ],
        "3.4_N-Security_Efficient_Frontier_Without_Short_Selling": [],
        "3.5_The_Mutual_Fund_Theorem": [
            "3.5.1_The_Global_Minimum-Variance_Portfolio",
            "3.5.2_The_Diversified_Portfolio",
            "3.5.3_The_Mutual_Fund_Theorem"
        ],
        "3.6_Investor_Utility_Function": [
            "3.6.1_Utility_Functions_and_Expected_Utility_Maximization",
            "3.6.2_Risk-Averse_Risk-Neutral_and_Risk-Seeking_Investors"
        ],
        "3.7_Diversification_and_Randomly_Selected_Securities": [
            "3.7.1_Mean_Portfolio_Variance_and_the_Uniform_Dirichlet_Distribution",
            "3.7.2_Mean_Portfolio_Variance_using_the_NASDAQ"
        ],
        "3.8_Exercises": [
            "3.8.1_Conceptual_Exercises",
            "3.8.2_Application_Exercises",
            "3.8.3_Theoretical_Exercises"
        ],
        "References": []
    },
    "4_Capital_Market_Theory_and_Portfolio_Risk_Measures": {
        "4.1_The_Capital_Market_Theory": [
            "4.1.1_The_Capital_Market_Line_(CML)",
            "4.1.2_Expected_Return_and_Risk_of_the_Market_Portfolio",
            "4.1.3_The_Capital_Asset_Pricing_Model_(CAPM)",
            "4.1.4_The_Security_Market_Line_(SML)",
            "4.1.5_CAPM_Security_Risk_Decomposition"
        ],
        "4.2_Portfolio_Risk_Measures": [
            "4.2.1_The_Sharpe_Ratio",
            "4.2.2_The_Sortino_Ratio",
            "4.2.3_The_Maximum_Drawdown",
            "4.2.4_Quantile_Functions",
            "4.2.5_Value-at-Risk",
            "4.2.6_Conditional_Value-at-Risk",
            "4.2.7_Coherent_Risk_Measures"
        ],
        "4.3_Introduction_to_Linear_Factor_Models": [
            "4.3.1_Definition_and_Intuition",
            "4.3.2_Portfolio_Variance_Decomposition",
            "4.3.3_Factor_Categorization",
            "4.3.4_Alpha_and_Beta",
            "4.3.5_CAPM_Beta_Versus_Linear_Factor_Beta",
            "4.3.6_Fama-French_Three-Factor_Model"
        ],
        "4.4_Exercises": [
            "4.4.1_Conceptual_Exercises",
            "4.4.2_Application_Exercises",
            "4.4.3_Theoretical_Exercises"
        ],
        "References": []
    },
    "5_Binomial_Trees_and_Security_Pricing_Modeling": {
        "5.1_The_General_Binomial_Tree_Model_of_Security_Prices": [],
        "5.2_The_Cox-Ross-Rubinstein_Tree": [
            "5.2.1_The_Real-World_CRR_Tree",
            "5.2.2_The_Risk-Neutral_CRR_Tree"
        ],
        "5.3_Continuous-Time_Limit_of_the_CRR_Pricing_Formula": [
            "5.3.1_The_Lindeberg_Central_Limit_Theorem",
            "5.3.2_The_Continuous-Time_Security_Price_Formula"
        ],
        "5.4_Basic_Properties_of_Continuous-Time_Security_Prices": [
            "5.4.1_Some_Statistical_Formulas_for_Continuous-Time_Security_Prices",
            "5.4.2_Some_Probability_Formulas_for_Continuous-Time_Security_Prices"
        ],
        "5.5_Exercises": [
            "5.5.1_Conceptual_Exercises",
            "5.5.2_Application_Exercises",
            "5.5.3_Theoretical_Exercises"
        ],
        "References": []
    },
    "6_Stochastic_Calculus_and_Geometric_Brownian_Motion_Model": {
        "6.1_Stochastic_Processes_The_Evolution_of_Randomness": [
            "6.1.1_Notation_for_Probability_Spaces",
            "6.1.2_Basic_Concepts_of_Random_Variables",
            "6.1.3_Basic_Concepts_of_Stochastic_Processes",
            "6.1.4_Convergence_of_Random_Variables",
            "6.1.5_Skewness_and_Kurtosis"
        ],
        "6.2_Filtrations_and_Adapted_Processes": [
            "6.2.1_Filtrations_The_Evolution_of_Information",
            "6.2.2_Conditional_Expectations_Properties_and_Intuition",
            "6.2.3_Adapted_Processes_Definition_and_Intuition"
        ],
        "6.3_Martingales_A_Brief_Introduction": [
            "6.3.1_Basic_Concepts",
            "6.3.2_Martingale_as_a_Necessary_Condition_of_an_Efficient_Market"
        ],
        "6.4_Modeling_Security_Price_Behavior": [
            "6.4.1_From_Deterministic_Model_to_Stochastic_Model",
            "6.4.2_Innovation_Processes_An_Intuition",
            "6.4.3_Securities_Paying_a_Continuous_Cash_Dividend"
        ],
        "6.5_Brownian_Motion": [
            "6.5.1_Definition_of_Brownian_Motion",
            "6.5.2_Some_Properties_of_Brownian_Motion_Paths",
            "6.5.3_Visualization_of_Brownian_Paths",
            "6.5.4_Markov_Property_for_Brownian_Motion"
        ],
        "6.6_Quadratic_Variation_and_Covariation": [
            "6.6.1_Motivation_Definition_and_Notation",
            "6.6.2_Basic_Properties",
            "6.6.3_Quadratic_Variation_and_Covariation_Properties_of_BM",
            "6.6.4_Significance_of_Quadratic_Variation"
        ],
        "6.7_Itô_Integral_A_Brief_Introduction": [
            "6.7.1_Importance_of_Itô_Integral_with_Respect_to_BM",
            "6.7.2_Basic_Concepts",
            "6.7.3_A_Famous_Example"
        ],
        "6.8_Itô's_Formula_for_Brownian_Motion": [
            "6.8.1_Itô_Processes",
            "6.8.2_Itô's_Lemma_for_Brownian_Motion",
            "6.8.3_Risk-Neutral_Probability_Measure",
            "6.8.4_Girsanov_Theorem_for_a_Single_Brownian_Motion"
        ],
        "6.9_Geometric_Brownian_Motion": [
            "6.9.1_GBM_Definition",
            "6.9.2_GBM_Basic_Properties",
            "6.9.3_Relation_Between_Binomial_Tree_Model_and_GBM_Model"
        ],
        "6.10_BM_as_a_Limit_of_Simple_Symmetric_RW": [],
        "6.11_Exercises": [
            "6.11.1_Conceptual_Exercises",
            "6.11.2_Application_Exercises",
            "6.11.3_Theoretical_Exercises"
        ],
        "References": []
    },
    "7_Derivatives_Forwards_Futures_Swaps_and_Options": {
        "7.1_Derivative_Securities_An_Overview": [
            "7.1.1_Basic_Concepts",
            "7.1.2_Basic_Functions_of_Derivatives",
            "7.1.3_Characteristics_of_Derivative_Valuation",
            "7.1.4_No-Arbitrage_Principle_and_Law_of_One_Price"
        ],
        "7.2_Forwards": [
            "7.2.1_Basic_Concepts",
            "7.2.2_Forwards_on_Assets_Paying_a_Continuous_Cash_Dividend",
            "7.2.3_Forward_Price_Formula_and_the_Spot-Forward_Parity",
            "7.2.4_Forward_Value_Formula"
        ],
        "7.3_Futures": [
            "7.3.1_Evolution_from_Forwards_to_Futures",
            "7.3.2_Basic_Concepts",
            "7.3.3_Impact_of_Daily_Settlement_A_Brief_Discussion"
        ],
        "7.4_Swaps": [
            "7.4.1_A_Brief_Introduction"
        ],
        "7.5_Options": [
            "7.5.1_Basic_Concepts",
            "7.5.2_How_Options_Work",
            "7.5.3_Terminal_Payoff_and_Profit_Diagrams",
            "7.5.4_Market_Sentiment_Terminologies_and_Option_Moneyness",
            "7.5.5_Option_Strategies_Straddle_Strangle_and_Spread",
            "7.5.6_Put-Call_Parity_for_European_Options_Revisited",
            "7.5.7_Relation_Among_Put_Call_and_Forward",
            "7.5.8_Intrinsic_Value_and_Time_Value",
            "7.5.9_Some_General_Relations_of_Options",
            "7.5.10_Put-Call_Parity_for_American_Options",
            "7.5.11_Boundary_Conditions_for_European_Options"
        ],
        "7.6_Exercises": [
            "7.6.1_Conceptual_Exercises",
            "7.6.2_Application_Exercises",
            "7.6.3_Theoretical_Exercises"
        ],
        "References": []
    },
    "8_The_BSM_Model_and_European_Option_Pricing": {
        "8.1_The_BSM_Model": [
            "8.1.1_Marketplace_Assumptions",
            "8.1.2_Money_Market_Account_and_the_Underlier_Model",
            "8.1.3_Self-Financing_Replicating_Portfolio",
            "8.1.4_Derivation_of_the_BSM_p.d.e."
        ],
        "8.2_Applications_of_BSM_Pricing_to_European_Calls_and_Puts": [
            "8.2.1_Solving_the_BSM_p.d.e._for_European_Calls",
            "8.2.2_BSM_Pricing_Formula_for_European_Puts",
            "8.2.3_Delta_and_the_Partial_Derivative_Relative_to_Strike_Price",
            "8.2.4_European_Call_and_Put_Deltas_at_Expiration"
        ],
        "8.3_Application_to_Pricing_Warrants": [],
        "8.4_Risk-Neutral_Pricing": [
            "8.4.1_Review_of_Conditional_Expectation",
            "8.4.2_From_BSM_Pricing_to_Risk-Neutral_Pricing",
            "8.4.3_The_Fundamental_Theorems_of_Asset_Pricing",
            "8.4.4_Risk-Neutral_Pricing_of_European_Calls_and_Puts"
        ],
        "8.5_Binomial_Approach_to_Pricing_European_Options": [
            "8.5.1_One-Period_Binomial_Pricing_by_Self-Financing_Replication",
            "8.5.2_One-Period_Binomial_Pricing_by_Risk_Neutrality",
            "8.5.3_Two-Period_Binomial_Pricing",
            "8.5.4_n-Period_Binomial_Pricing"
        ],
        "8.6_Delta_Hedging": [
            "8.6.1_Theoretical_Delta_Hedging_for_European_Calls",
            "8.6.2_Application_of_Delta_Hedging_to_Selling_European_Calls"
        ],
        "8.7_Option_Greeks_and_Managing_Portfolio_Risk": [
            "8.7.1_Option_Greeks_for_Portfolios_and_the_BSM_p.d.e.",
            "8.7.2_Delta-Neutral_Portfolios",
            "8.7.3_Delta-Gamma-Neutral_Portfolios"
        ],
        "8.8_The_BSM_Model_Versus_Market_Data": [
            "8.8.1_Jumps_in_Security_Prices",
            "8.8.2_Skewness_and_Kurtosis_in_Security_Log_Returns",
            "8.8.3_Volatility_Skews"
        ],
        "8.9_A_Step_Beyond_the_BSM_Model_Merton_Jump_Diffusion": [
            "8.9.1_Poisson_Processes",
            "8.9.2_The_MJD_Stochastic_Process",
            "8.9.3_Illustration_of_MJD_Jump_Skewness_and_Kurtosis",
            "8.9.4_No-Arbitrage_Condition_and_Market_Incompleteness",
            "8.9.5_Pricing_European_Calls_with_an_MJD_Underlier",
            "8.9.6_MJD_Volatility_Smile"
        ],
        "8.10_A_Glimpse_Ahead": [],
        "8.11_Exercises": [
            "8.11.1_Conceptual_Exercises",
            "8.11.2_Application_Exercises",
            "8.11.3_Theoretical_Exercises"
        ],
    },
}



import os
from typing import Dict, Any

def create_directories_and_files(
        base_path: str, 
        structure: Dict[str, Any], 
        readme_file, 
        parent_path: str = "", 
        level: int = 1
    ):
    heading = "#" * level

    for key, value in structure.items():
        current_path = os.path.join(base_path, key.replace(" ", "_").replace("/", "_").replace("-", "_"))

        # 创建目录
        os.makedirs(current_path, exist_ok=True)

        # 在README中添加章节标题
        if parent_path:
            readme_file.write(f"{heading} {parent_path}/{key}\n\n")
        else:
            readme_file.write(f"{heading} {key}\n\n")

        # 递归调用创建子目录和文件
        if isinstance(value, dict) and value:
            create_directories_and_files(
                current_path, 
                value, 
                readme_file, 
                parent_path + "/" + key if parent_path else key, 
                level + 1
            )
        elif isinstance(value, list) and value:
            for idx, item in enumerate(value):
                if isinstance(item, dict) and item:
                    create_directories_and_files(
                        current_path, 
                        item, 
                        readme_file, 
                        parent_path + "/" + key if parent_path else key, 
                        level + 1
                    )
                else:
                    item = f"{idx:02d}_{item}"
                    file_name = item.replace(" ", "_").replace("/", "_").replace("-", "_") + ".py"
                    file_path = os.path.join(current_path, file_name)
                    with open(file_path, 'w', encoding='utf-8') as file:
                        file.write(f"# {item}\n\n")
                        file.write(f'"""\n\nLecture: {parent_path}/{key}\nContent: {item}\n\n"""\n\n')

                    # 在README中添加文件链接
                    item_clean = item.replace(" ", "_").replace("/", "_").replace("-", "_")
                    parent_clean = parent_path.replace(" ", "_").replace("/", "_").replace("-", "_")
                    key_clean = key.replace(" ", "_").replace("/", "_").replace("-", "_")
                    readme_file.write(f"- [{item}](./{parent_clean}/{key_clean}/{item_clean}.py)\n")
                    
                    
                    file_name = item.replace(" ", "_").replace("/", "_").replace("-", "_") + ".md"
                    file_path = os.path.join(current_path, file_name)
                    with open(file_path, 'w', encoding='utf-8') as file:
                        file.write(f"# {item}\n\n")
                        file.write(f'"""\n\nLecture: {parent_path}/{key}\nContent: {item}\n\n"""\n\n')

                    # 在README中添加文件链接
                    item_clean = item.replace(" ", "_").replace("/", "_").replace("-", "_")
                    parent_clean = parent_path.replace(" ", "_").replace("/", "_").replace("-", "_")
                    key_clean = key.replace(" ", "_").replace("/", "_").replace("-", "_")
                    readme_file.write(f"- [{item}](./{parent_clean}/{key_clean}/{item_clean}.md)\n")
        else:
            # 创建文件并写入初始内容
            file_name = key.replace(" ", "_").replace("/", "_").replace("-", "_") + ".py"
            file_path = os.path.join(current_path, file_name)
            with open(file_path, 'w', encoding='utf-8') as file:
                file.write(f"# {key}\n\n")
                file.write(f'"""\n\nLecture: {parent_path}/{key}\nContent: {key}\n\n"""\n\n')

            # 在README中添加文件链接
            parent_clean = parent_path.replace(" ", "_").replace("/", "_").replace("-", "_")
            key_clean = key.replace(" ", "_").replace("/", "_").replace("-", "_")
            readme_file.write(f"- [{key}](./{parent_clean}/{key_clean}/{file_name})\n")
            
            
            file_name = key.replace(" ", "_").replace("/", "_").replace("-", "_") + ".md"
            file_path = os.path.join(current_path, file_name)
            with open(file_path, 'w', encoding='utf-8') as file:
                file.write(f"# {key}\n\n")
                file.write(f'"""\n\nLecture: {parent_path}/{key}\nContent: {key}\n\n"""\n\n')

            # 在README中添加文件链接
            parent_clean = parent_path.replace(" ", "_").replace("/", "_").replace("-", "_")
            key_clean = key.replace(" ", "_").replace("/", "_").replace("-", "_")
            readme_file.write(f"- [{key}](./{parent_clean}/{key_clean}/{file_name})\n")

        # 添加空行以分隔不同的章节
        readme_file.write("\n")

def main():
    root_dir = './'
    # 创建根目录
    os.makedirs(root_dir, exist_ok=True)

    # 创建 README.md 文件
    with open(os.path.join(root_dir, "README.md"), 'w', encoding='utf-8') as readme_file:
        readme_file.write("# 金融数学\n\n")
        readme_file.write("这是一个关于金融数学的目录结构。\n\n")
        create_directories_and_files(root_dir, structure, readme_file)

    print("目录和文件结构已生成，并创建 README.md 文件。")

if __name__ == "__main__":
    main()